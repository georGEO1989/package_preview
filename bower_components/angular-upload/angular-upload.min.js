"use strict";angular.module("lr-upload",["lr-upload.formdata","lr-upload.iframe","lr-upload.directives"]),angular.module("lr-upload.directives",[]),angular.module("lr-upload.directives").directive("uploadButton",["upload",function(a){return{restrict:"EA",scope:{options:"=?uploadButton",multiple:"=?",forceIFrameUpload:"=?forceIframeUpload",url:"@",method:"@",onSuccess:"&",onError:"&"},link:function(b,c){var d=angular.element(c),e=d.children()[0];d.css({position:"relative",overflow:"hidden",width:e.offsetWidth,height:e.offsetHeight,cursor:"pointer"});var f=angular.element('<input type="file" />');f.bind("change",function(){b.options||(b.options={});var c={url:b.url,method:b.method||b.options.method||"POST",forceIFrameUpload:b.forceIFrameUpload||b.options.forceIFrameUpload||!1,data:b.options.data||{}};c.data[b.options.paramName||"file"]=f,a(c).then(function(a){b.onSuccess({response:a})},function(a){b.onError({response:a})})}),d.append(f),a.support.formData&&b.$watch("multiple + forceIFrameUpload",function(a){f.attr("multiple",!(!a||b.forceIFrameUpload))})}}}]),angular.module("lr-upload.formdata",[]).factory("formDataTransform",function(){return function(a){var b=new FormData;return angular.forEach(a,function(a,c){if(angular.isElement(a)){var d=[];angular.forEach(a,function(a){angular.forEach(a.files,function(a){d.push(a)})}),d.length>1?angular.forEach(d,function(a,d){b.append(c+"["+d+"]",a)}):b.append(c,d[0])}else b.append(c,a)}),b}}).factory("formDataUpload",["$http","formDataTransform",function(a,b){return function(c){return a(angular.extend(c,{headers:{"Content-Type":!1},transformRequest:b}))}}]),angular.module("lr-upload.iframe",[]).factory("iFrameUpload",["$q","$http","$document","$rootScope",function(a,b,c,d){function e(a,b){if(a.indexOf)return a.indexOf(b);for(var c=0;c<a.length;c++)if(b===a[c])return c;return-1}function f(f){var g=[],h=[],i=a.defer(),j=i.promise;angular.forEach(f.data||{},function(a,b){angular.isElement(a)&&(delete f.data[b],a.attr("name",b),g.push(a))});var k=/\?/.test(f.url)?"&":"?";"DELETE"===f.method?(f.url=f.url+k+"_method=DELETE",f.method="POST"):"PUT"===f.method?(f.url=f.url+k+"_method=PUT",f.method="POST"):"PATCH"===f.method&&(f.url=f.url+k+"_method=PATCH",f.method="POST");var l=angular.element(c[0].body),m="iframe-transport-"+d.$new().$id,n=angular.element("<form></form>");n.attr("target",m),n.attr("action",f.url),n.attr("method",f.method||"POST"),n.css("display","none"),g.length&&(n.attr("enctype","multipart/form-data"),n.attr("encoding","multipart/form-data"));var o=angular.element('<iframe name="'+m+'" src="javascript:false;"></iframe>');return o.bind("load",function(){function a(a,b){var c=[];return angular.isFunction(b)?b(a,c):(angular.forEach(b,function(b){a=b(a,c)}),a)}function c(){var a=e(b.pendingRequests,f);-1!==a&&(b.pendingRequests.splice(a,1),f.$iframeTransportForm.remove(),delete f.$iframeTransportForm)}o.unbind("load").bind("load",function(){var c;try{var d=this.contentWindow?this.contentWindow.document:this.contentDocument;if(c=angular.element(d.body).text(),!c.length)throw new Error}catch(e){}n.append(angular.element('<iframe src="javascript:false;"></iframe>'));try{c=a(c,b.defaults.transformResponse)}catch(e){}i.resolve({data:c,status:200,headers:[],config:f})}),angular.forEach(g,function(a){var b=a.clone();h.push(b),a.after(b),n.append(a)}),angular.forEach(f.data,function(a,b){var c=angular.element('<input type="hidden" />');c.attr("name",b),c.val(a),n.append(c)}),f.$iframeTransportForm=n,b.pendingRequests.push(f),n[0].submit(),h&&h.length&&angular.forEach(g,function(a,b){var c=h[b];c.replaceWith(a)}),j.then(c,c)}),n.append(o),l.append(n),j}return f}]),angular.module("lr-upload").factory("upload",["$window","formDataUpload","iFrameUpload",function(a,b,c){function d(a){return e.formData&&!a.forceIFrameUpload?b(a):c(a)}var e={fileInput:!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(a.navigator.userAgent)||angular.element('<input type="file">').prop("disabled")),fileUpload:!(!a.XMLHttpRequestUpload||!a.FileReader),formData:!!a.FormData};return d.support=e,d}]);